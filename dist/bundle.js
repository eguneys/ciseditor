var Tetris=function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t,e,n){window,t.exports=function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(t,e,n){"use strict";function r(t,e=[],n){let[r,...i]=t.split("."),o=document.createElement(r);return i.forEach(t=>{o.classList.add(t)}),e.forEach?e.forEach(t=>{o.appendChild(t)}):o.append(e),n&&(n.forEach?n.forEach(t=>t(o)):n(o)),o}n.r(e),n.d(e,"tag",function(){return r}),n.d(e,"div",function(){return i}),n.d(e,"textNode",function(){return o}),n.d(e,"updateChildren",function(){return l}),n.d(e,"fTranslateAbs",function(){return s}),n.d(e,"fAddClass",function(){return a}),n.d(e,"fAttribute",function(){return u}),n.d(e,"fListen",function(){return c}),n.d(e,"fHide",function(){return f}),n.d(e,"fShow",function(){return h});const i=(t,e,n)=>r("div"+t,e,n),o=t=>document.createTextNode(t),l=(t,e)=>{for(t=t.firstChild;t;)e(t),t=t.nextSibling},s=t=>e=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},a=t=>e=>{t.split(".").forEach(t=>{e.classList.add(t)})},u=t=>e=>(Object.keys(t).forEach(n=>{t[n]&&e.setAttribute(n,t[n])}),e),c=(t,e)=>n=>{n.addEventListener(t,()=>{e(n)})},f=t=>{t.classList.contains("hidden")||t.classList.add("hidden")},h=t=>{t.classList.contains("hidden")&&t.classList.remove("hidden")}},function(t,e,n){"use strict";function r(t){let e={};for(let n in t)e[n]=t[n];return e}function i(t,e){let n=[],r=[];return t.forEach(t=>e(t)?n.push(t):r.push(t)),[n,r]}function o(t,e){let n={};return Object.keys(t).forEach(r=>{let i=e(r,t[r]),o=Object.keys(i)[0];n[o]=i[o]}),n}function l(t,e){Object.keys(t).forEach(n=>e(n,t[n]))}function s(t,e){let n={};for(let r in t)e(r,t[r])&&(n[r]=t[r]);return n}function a(t,e){let n={};return t.forEach(t=>{let r=e(t),i=Object.keys(r)[0];n[i]||(n[i]=[]),n[i].push(r[i])}),n}n.d(e,"b",function(){return r}),n.d(e,"f",function(){return i}),n.d(e,"e",function(){return o}),n.d(e,"d",function(){return l}),n.d(e,"c",function(){return s}),n.d(e,"a",function(){return a})},function(t,e,n){"use strict";n.r(e);const r=1,i=2,o=3,l=1,s=2;function a(t){return function(t){const e=/^#([^\n]*)/,n=/^=([^\n]*)/;let l=[],s=[],a=t.split("\n"),u=0;if(a.forEach(t=>{if(""===t){if(l.length){let t=l.join("\n");s.push({type:r,pos:u,content:t}),l=[],u+=t.length+1}return void(u+=1)}let a;if(a=t.match(n)){let t=l.join("\n");l.length&&(s.push({type:r,pos:u,content:t}),l=[],u+=t.length+1),t=a[1],s.push({type:o,pos:u,content:t}),u+=t.length+2}else if(a=t.match(e)){let t=l.join("\n");l.length&&(s.push({type:r,pos:u,content:t}),l=[],u+=t.length+1),t=a[1],s.push({type:i,pos:u,content:t}),u+=t.length+2}else l.push(t)}),l.length){let t=l.join("\n");s.push({type:r,pos:u,content:t}),l=[],u+=t.length}return s}(t).map(t=>(t.type===r&&(t.content=function(t){return function(t){const e=/^</,n=/>$/;let r=s,i=[],o=[];return t.split(" ").forEach(t=>{let a;r===s?(a=t.match(e))?(o.push({type:s,content:i.join(" ")+" "}),r=l,i=[t],(a=t.match(n))&&(o.push({type:l,content:i.join(" ")}),r=s,i=[])):i.push(t):r===l&&((a=t.match(n))?(i.push(t),o.push({type:l,content:i.join(" ")}),r=s,i=[]):i.push(t))}),i.length>0&&o.push({type:r,content:i.join(" ")}),o}(t).map(t=>(t.type===l&&(t.content=function(t){let e;if(e=(t=t.substring(1,t.length-1)).match(/^([a-zA-Z][^\s]*) ([a-zA-Z][^\s]*) (.*)/)){let[t,n,r,i]=e;return{variation:n,base:r,line:i}}return{line:t}}(t.content)),t))}(t.content)),t))}n(1);var u=n(0);function c(t,e){let n=[],r=e.firstChild;for(;r;)n.push(r),r=r.nextSibling;for(let t of n)e.removeChild(t);let i=t.map(({type:t,content:e,pos:n})=>({pos:n,$_:f(t,e)}));return i.forEach(t=>{e.appendChild(t.$_)}),i}function f(t,e){switch(t){case o:return function(t){return Object(u.tag)("div",[],Object(u.fAttribute)({"data-ply":t}))}(e);case r:return function(t){return Object(u.tag)("p",t.map(({type:t,content:e})=>{switch(t){case l:let n=e.variation?`${e.variation} ${e.base}`:null,r={"data-line":e.line};return n&&(r["data-game"]=n),Object(u.tag)("span",[],Object(u.fAttribute)(r));case s:return Object(u.textNode)(e);default:return null}}))}(e);case i:return Object(u.tag)("h2",e);default:return null}}n.d(e,"parseMdFull",function(){return a}),n.d(e,"updatePreview",function(){return c})},function(t,e,n){t.exports=n(4)},function(t,e,n){n(5),n(6),n(7),n(8);const r=n(9);t.exports=r.app,t.exports.md=n(2),t.exports.version="1.3.0"},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){"use strict";n.r(e);var r={};n.r(r),n.d(r,"files",function(){return E}),n.d(r,"ranks",function(){return C}),n.d(r,"allKeys",function(){return S}),n.d(r,"pos2key",function(){return M}),n.d(r,"key2pos",function(){return P}),n.d(r,"black",function(){return A}),n.d(r,"white",function(){return $}),n.d(r,"asWhite",function(){return B}),n.d(r,"flip",function(){return F}),n.d(r,"readShapes",function(){return T}),n.d(r,"readFen",function(){return L}),n.d(r,"readMoves",function(){return N}),n.d(r,"readPly",function(){return _}),n.d(r,"writeFen",function(){return q}),n.d(r,"fPosToTranslateAbs",function(){return I});var i={};n.r(i),n.d(i,"svg",function(){return tt}),n.d(i,"renderShape",function(){return et}),n.d(i,"renderMarker",function(){return ot});var o=n(1);function l(t,e){return t?s(t):a(e)}function s(t){return new u(null,t)}function a(t){return new u(t)}function u(t,e){this.invalid=t,this.valid=e;const n=n=>{e=null,t=n,this.invalid=t,this.valid=e},r=n=>{e=n,t=null,this.valid=e,this.invalid=t};this.flatMap=(t,e=(t=>validation.invalid(t)))=>this.valid?t(this.valid):e(this.invalid),this.fold=(t,e=(t=>t))=>this.valid?t(this.valid):e(this.invalid),this.rawMap=t=>(this.valid&&r(t(e)),this),this.map=t=>this.copy().rawMap(t),this.check=(t,e)=>(this.valid&&t(this.valid)&&n(e),this),this.checkOr=(t,e,r)=>(!this.valid||t(this.valid)||e(this.valid)||n(r),this),this.getOrElse=t=>this.valid?this.valid:t(),this.copy=()=>new u(t,e),this.copyMap=t=>this.copy().map(t)}function c(t){this.index=t,this.char=String.fromCharCode(97+t)}function f(t){this.index=t,this.char=String.fromCharCode(49+t)}const h={A:new c(0),B:new c(1),C:new c(2),D:new c(3),E:new c(4),F:new c(5),G:new c(6),H:new c(7),of:t=>new c(7&t.index)},d={of:t=>new f(t.index>>3)};function p(t){this.index=t;let e=h.of(this),n=d.of(this);this.file=e,this.rank=n,this.key=e.char+n.char,this.hore=(t,e)=>{let n=e(this);return n?[n,...t(n)?[]:n.hore(t,e)]:[]},this.righte=t=>this.hore(t,t=>t.right()),this.lefte=t=>this.hore(t,t=>t.left()),this.down=()=>y.at(e.index,n.index-1),this.left=()=>y.at(e.index-1,n.index),this.downLeft=()=>y.at(e.index-1,n.index-1),this.downRight=()=>y.at(e.index+1,n.index-1),this.up=()=>y.at(e.index,n.index+1),this.right=()=>y.at(e.index+1,n.index),this.upLeft=()=>y.at(e.index-1,n.index+1),this.upRight=()=>y.at(e.index+1,n.index+1)}const y={apply:t=>new p(t),atfr:(t,e)=>new p(t.index+8*e.index),at:(t,e)=>0<=t&&t<8&&0<=e&&e<8?new p(t+8*e):null},m=[];for(let t=0;t<64;t++)m.push(t);y.all=m.map(t=>new p(t)),y.allKeys={},y.all.forEach(t=>y.allKeys[t.key]=t),y.fromKey=t=>y.allKeys[t],y.A1=new p(0),y.B1=new p(1),y.C1=new p(2);const g={forsyth:"P",roleString:"pawn"},b={forsyth:"N",roleString:"knight",dirs:[t=>y.at(t.file.index-1,t.rank.index+2),t=>y.at(t.file.index-1,t.rank.index-2),t=>y.at(t.file.index+1,t.rank.index+2),t=>y.at(t.file.index+1,t.rank.index-2),t=>y.at(t.file.index-2,t.rank.index+1),t=>y.at(t.file.index-2,t.rank.index-1),t=>y.at(t.file.index+2,t.rank.index+1),t=>y.at(t.file.index+2,t.rank.index-1)]},v={forsyth:"B",roleString:"bishop",dirs:[t=>t.upLeft(),t=>t.upRight(),t=>t.downLeft(),t=>t.downRight()]},w={color:t=>({role:"rook",color:t}),forsyth:"R",roleString:"rook",dirs:[t=>t.up(),t=>t.down(),t=>t.left(),t=>t.right()]},k={forsyth:"Q",roleString:"queen",dirs:[w.dirs,v.dirs].flat()},x={color:t=>({role:"king",color:t}),forsyth:"K",roleString:"king",dirs:k.dirs},O={all:[x,k,v,w,g,b],allByRole:{}};O.all.forEach(t=>O.allByRole[t.roleString]=t),O.allByForsyth={},O.all.forEach(t=>O.allByForsyth[t.forsyth]=t),O.forsyth=t=>O.allByForsyth[t];const j={key:"g",color:"#15781B",opacity:1,lineWidth:10},E=["a","b","c","d","e","f","g","h"],C=["1","2","3","4","5","6","7","8"],S=Array.prototype.concat(...E.map(t=>C.map(e=>t+e))),M=t=>S[8*t[0]+t[1]],P=t=>[t.charCodeAt(0)-97,t.charCodeAt(1)-49],A="black",$="white";function B(t){return t===$}function F(t){return t===$?A:$}let R={w:$,b:A},K={k:"king",q:"queen",r:"rook",b:"bishop",n:"knight",p:"pawn"};function T(t){return t?t.split(" ").map(t=>{let[e,n]=t.split("-");return{orig:(t=>t)(e),dest:(t=>t)(n),brush:j}}):[]}function L(t){let[e,n,r,i]=t.split(" "),o=R[n],l={};return e.split("/").forEach((t,e)=>{e=7-e;let n=0;for(let r of t){let t,i;(t=K[r])?i=A:(t=K[r.toLowerCase()])&&(i=$),i?(l[M([n,e])]={role:t,color:i},n++):n+=parseInt(r)}}),{pieces:l,color:o}}function N(t){const e=/^(\d*)\.\.\.$/,n=/^(\d*)\.$/;let r,i,o=[];return t.split(" ").forEach(t=>{let l;(l=t.match(e))?(i=2*parseInt(l[0]),r=[null]):(l=t.match(n))?(i=2*parseInt(l[0])-1,r=[]):(l=moveMatch(t))&&(r.push({ply:i,...l}),i++,2===r.length&&(o.push(r),r=[]))}),1===r.length&&o.push(r),{moves:o}}function _(t){return parseInt(t)}function q({pieces:t}){let e="";for(let n=7;n>=0;n--){let r=0;for(let i=0;i<=7;i++){let o;if(o=t[M([i,n])]){r>0&&(e+=r,r=0);let t=O.allByRole[o.role];e+=o.color===$?t.forsyth.toUpperCase():t.forsyth.toLowerCase()}else r++}r>0&&(e+=r),e+="/"}return e}const I=t=>{const e=t.width/8,n=t.height/8;return(t,r)=>((t,e,n,r)=>[(e?t[0]:7-t[0])*n,(e?7-t[1]:t[1])*r])(t,r,e,n)},W={name:"king",castledKingFile:h.G,castledRookFile:h.F,tripToRook:(t,e)=>t.righte(t=>e.pieces[t.key])},H={name:"queen",castledKingFile:h.C,castledRookFile:h.D,tripToRook:(t,e)=>t.lefte(t=>e.pieces[t.key])};function V(t,e){this.take=n=>{let r=Object(o.b)(t);return delete r[n.key],new V(r,e)},this.place=(n,r)=>{let i=Object(o.b)(t);return i[r.key]=n,new V(i,e)},this.move=(n,r)=>{let i=Object(o.b)(t);return i[r.key]=i[n.key],delete i[n.key],new V(i,e)},this.taking=(n,r)=>{let i=Object(o.b)(t);return i[r.key]=i[n.key],delete i[n.key],new V(i,e)},this.actorsOf=()=>{let[t,e]=Object(o.f)(Object.values(this.actors),t=>"white"===t.color);return{white:t,black:e}},this.kingPosOf=e=>{let n=Object.keys(t).find(n=>{let r=t[n];return r.color===e&&"king"===r.role});return y.fromKey(n)},this.actorAt=t=>this.actors[t],this.color=e,this.pieces=t,this.actors=Object(o.e)(t,(t,e)=>({[t]:new z(e,y.fromKey(t),this)}))}function D(t,e){this.board=t,this.color=e,t.actorsOf(e)}function Q({piece:t,orig:e,dest:n,situationBefore:r,after:i,capture:o,promotion:l,castle:s,enpassant:a}){this.piece=t,this.orig=e,this.dest=n,this.situationBefore=()=>r,this.after=()=>i,this.before=()=>r.board,this.situationAfter=()=>new D(i,F(t.color))}function z(t,e,n){let r=t.color;this.color=r,this.pos=e,this.pseudoValidMoves=function(){let o=[];switch(t.role){case"pawn":let h=s()(e),d=h;function f(t){let i=t(h);if(!i)return null;if(!n.pieces[i.key]||n.pieces[i.key].color===r)return null;let o=n.taking(e,i);return c(i,o,{capture:i})}let p=s()(d),y=[];if(p){let t=n.move(e,p);y=c(p,t)}o.push([d&&l(d)||[],y,f(t=>t.left())||[],f(t=>t.right())||[]].flat());break;case"king":o.push(a(x.dirs)),o.push(i());break;case"knight":o.push(a(b.dirs));break;case"bishop":o.push(u(v.dirs));break;case"rook":o.push(u(w.dirs));break;case"queen":o.push(u(k.dirs))}return o.flatMap(t=>t)};const i=()=>o(W).concat(o(H));function o(t){let e=n.kingPosOf(r);if(!e)return[];let i=t.tripToRook(e,n),o=i[i.length-1],l=y.atfr(t.castledKingFile,e.rank),s=y.atfr(t.castledRookFile,o.rank),a={king:{[e.key]:l},rook:{[o.key]:s},side:t.name};return[c(e,n.take(e).take(o).place(x.color(r),l).place(w.color(r),s),{castle:a})]}function l(t){let r=n.move(e,t);return r?c(t,r):null}function s(){return function(t){return"white"===t?t=>t.up():t=>t.down()}(t.color)}function a(t){return t.flatMap(t=>t(e)||[]).flatMap(t=>{let r=n.move(e,t);return r?[c(t,r)]:[]})}function u(t){let i=[];return t.forEach(t=>(function t(o,l){let s;if(s=l(o)){let o=n.pieces[s.key];if(o){if(o.color!==r){let t=n.taking(e,s);i.push(c(s,t,{capture:s}))}}else{let r=n.move(e,s);r&&i.push(c(s,r)),t(s,l)}}})(e,t)),i}function c(r,i,o){let l,s,a,u;return o&&(l=o.capture,a=o.castle,s=o.promotion,u=o.enpassant),new Q({piece:t,orig:e,dest:r,situationBefore:new D(n,t.color),after:i,capture:l,castle:a,promotion:s,enpassant:u})}this.castleOn=o}function Z(t,e,n,r,i,l,u){function c(t,e){return!t||t===e}this.san=u,this.dest=t,this.role=e,this.capture=n,this.file=r,this.rank=i,this.promotion=l,this.move=n=>{let l=null;return Object(o.d)(n.board.pieces,(o,s)=>{if(!l&&s.color===n.color&&s.role===e.roleString&&c(r,y.fromKey(o).file.char)&&c(i,y.fromKey(o).rank.char)){let e=new z(s,y.fromKey(o),n.board);l=e.pseudoValidMoves().find(e=>e.dest.key===t.key)}}),l?s(l):a(`No move found: ${u}`)}}function G(t,e){this.san=e,this.side=t,this.move=e=>l(e.board.kingPosOf(e.color),"No king found").flatMap(n=>l(e.board.actorAt(n.key),"No Actor found").flatMap(e=>l(e.castleOn(t)[0],"Cannot castle")))}function X(t){const e=/^(\d*)\.\.\.$/,n=/^(\d*)\.$/;let r,i,o=[];return t.split(" ").forEach(t=>{let l;if(l=t.match(e))i=2*parseInt(l[0]),r=[null];else if(l=t.match(n))i=2*parseInt(l[0])-1,r=[];else{let e=function(t){if("O-O"===t||"o-o"===t||"0-0"===t)return s(new G(W,t));if("O-O-O"===t||"o-o-o"===t||"0-0-0"===t)return s(new G(H,t));let e=t.match(/^(N|B|R|Q|K|)([a-h]?)([1-8]?)(x?)([a-h][1-8])(=?[NBQR]?)(\+?)(\#?)$/);if(!e)return a({err:"Couldn't parse",san:t});let[n,r,i,o,l,u,c,f,h]=e,d=y.fromKey(u);return u?s(new Z(d,O.forsyth(r)||g,""!==l,i,o,c,t)):a({err:"Invalid move",san:t})}(t).map(t=>({ply:i++,move:t}));r.push(e),2===r.length&&(o.push(r),r=[])}}),1===r.length&&o.push(r),o}function Y(t,e){return new U(t,e)}function U(t,e){t.fold(({ply:t,move:n})=>{this.ply=t,this.san=n.san,this.plyStrWhite=(t+1)/2+". ",this.plyStrBlack=t/2+"... ",e(t).fold(t=>t,t=>{this.err=t})},({err:t,san:e})=>{this.ply="E",this.plyStrWhite="E. ",this.plyStrBlack="E. ",this.err=t,this.san=e})}V.initial=()=>V.fromFen("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"),V.fromFen=t=>{let{pieces:e,color:n}=L(t);return new V(e,n)},D.apply=()=>new D(V.initial(),"white");var J=n(0);function tt(t,e=[]){let n=document.createElementNS("http://www.w3.org/2000/svg",t);return e.forEach&&e.forEach(t=>n.appendChild(t)),n}function et(t,e,n){let r,i=it(P(t.orig),e);if(t.dest){let o=it(P(t.dest),e);r=function(t,e,n,r){const i=function(t){return 10/512*t.width}(r),o=rt(e,r),l=rt(n,r),s=l[0]-o[0],a=l[1]-o[1],u=Math.atan2(a,s),c=Math.cos(u)*i,f=Math.sin(u)*i;return lt(tt("line"),{stroke:t.color,"stroke-width":nt(t,r),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+t.key+")",opacity:t.opacity,x1:o[0],y1:o[1],x2:l[0]-c,y2:l[1]-f})}(t.brush,i,o,n)}else r=function(t,e,n){const r=rt(e,n),i=function(t){return t.width/512*4}(n),o=(n.width+n.height)/32;return lt(tt("circle"),{stroke:t.color,"stroke-width":i,fill:"none",opacity:t.opacity,cx:r[0],cy:r[1],r:o-i/2})}(t.brush,i,n);return r}function nt(t,e){return(t.lineWidth||10)/512*e.width}function rt(t,e){return[(t[0]+.5)*e.width/8,(7.5-t[1])*e.height/8]}function it(t,e){return"white"===e?t:[7-t[0],7-t[1]]}function ot(t){const e=lt(tt("marker"),{id:"arrowhead-"+t.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return e.appendChild(lt(tt("path"),{d:"M0,0 V4 L3,2 Z",fill:t.color})),e.setAttribute("mdKey",t.key),e}function lt(t,e){for(const n in e)t.setAttribute(n,e[n]);return t}let{ranks:st,files:at,key2pos:ut,fPosToTranslateAbs:ct}=r,{svg:ft,renderMarker:ht,renderShape:dt}=i,{div:pt,tag:yt,fAttribute:mt,fTranslateAbs:gt,fListen:bt,updateChildren:vt}=J;var wt=n(2);function kt(t,e,n){let r,i,o,l,s,a,u,c,f,h,d,{history:p}=t;this.el=n,this.bounds=()=>c,this.init=t=>{r=t.game||"main",i=t.color,o=T(t.shapes),l=parseInt(t.ply),s={},a=[],(u=p.moveFor(r,l))?u.value.fold(t=>{let e=t.situationAfter();s=e.board.pieces,a.push(t.orig.key),a.push(t.dest.key)},t=>{f=t}):f=`No move found ${r}:${l}`,i=i||p.colorFor(r),c=n.getBoundingClientRect()},this.syncVisible=()=>{c=n.getBoundingClientRect(),this.isInViewport=function(t){return t.top>=0&&t.left>=0&&t.bottom<=window.innerHeight&&t.right<=window.innerWidth}(c)},this.render=()=>{d&&(d(),n.removeChild(h.wrapper)),this.wrap()},this.wrap=()=>{h=function(t,e,n,r,i){let o=B(t),l=ct(r),s=yt("md-board",[...i.map(t=>{let e=ut(t),n=yt("square.last-move",[],gt(l(e,o)));return n.mdKey=t,n}),...Object.keys(e).map(t=>{let n=ut(t),r=e[t],i=yt(`piece.${r.color}.${r.role}`,[],gt(l(n,o)));return i.mdKey=t,i})]),a=ft("svg",[ft("defs",[ht(j)]),...n.map(e=>dt(e,t,r))]);return{wrapper:yt("md-wrap",[s,a,yt("coords.ranks."+t,st.map(t=>yt("coord",t))),yt("coords.files."+t,at.map(t=>yt("coord",t)))]),board:s,svg:a}}(i,s,o,c,a),n.appendChild(h.wrapper),d=function(t,e){const n=new window.ResizeObserver(()=>{!function(t,e){let n=e.getBoundingClientRect(),r=ct(n);vt(e,e=>{gt(r(ut(e.mdKey),t))(e)})}(B(i),h.board),function(t,e,n){let{board:r,svg:i}=t,o=r.getBoundingClientRect(),l=i.firstChild,s=[];for(l=l.nextSibling;l;)s.push(l),l=l.nextSibling;for(const t of s)i.removeChild(t);e.forEach(t=>{i.appendChild(dt(t,n,o))})}(h,o,i)});return n.observe(t),()=>{n.unobserve(t)}}(n)}}function xt(t,e,n){let r=n.dataset.game||"main initial",i=n.dataset.line,o=n.dataset.color,l=r.split(" ");1===l.length&&l.push("main"),this.game=l[0],this.base=l[1],this.color=o;let s=X(i);this.flat=s.flat().flatMap(t=>t?t.copyMap(t=>[t]).getOrElse(t=>[]):[]);let u=(e,n)=>{t.show(this.game,e,n)},c=()=>{t.hide()};this.wrap=()=>{const e=e=>{let n=t.history.moveFor(this.game,e);return n?n.value:a(`No move for ${this.game}`)};let r=t.history.lineDepthFor(this.game),i=Object(J.fAddClass)(`depth${r}`);(function(t,e,n){let r=t=>r=>{["touchstart","mouseover"].forEach(n=>bt(n,n=>e(t,n))(r)),["touchend","mouseout"].forEach(t=>bt(t,n)(r))};return t.flatMap(([t,e])=>{let n=t&&r(t.ply),i=e&&r(e.ply),o=t&&mt({title:t.err,"data-err":t.err}),l=e&&mt({title:e.err,"data-err":e.err});return t&&e?[yt("strong.moven",t.plyStrWhite),yt("span.movem",t.san+" ",[o,n]),yt("span.movem",e.san+" ",[l,i])]:t?[yt("strong.moven",t.plyStrWhite),yt("span.movem",t.san+" ",[o,n])]:[yt("strong.moven",e.plyStrBlack),yt("span.movem",e.san+" ",[l,i])]})})(s.map(([t,n])=>[t&&Y(t,e),n&&Y(n,e)]),u,c).forEach(t=>n.appendChild(t)),i(n)}}function Ot(t,e){let{lines:n}=t,r=Object(o.a)(n,t=>({[t.game]:t})),i=Object.keys(r),l={},u={},c={};function f(t,e){if(!l[t])return console.warn(`No variation found for ${t}`),null;let n=l[t].find(t=>t.ply===e);return n||(console.warn(`No move found for ${t} ${e}`),null)}function h(t,e){if(0===e)return D.apply();let n=f(t,e);return n?n.value.map(t=>t.situationAfter()).getOrElse(D.apply):D.apply()}function d(t,e){return t.map(({ply:t,move:n})=>({ply:t,value:e?n.move(e).flatMap(t=>(e=t.situationAfter(),s(t)),t=>(e=null,a(t))):a("No situation.")}))}i.forEach(t=>{c[t]=function t(e){if("initial"===e||!r[e])return"white";let n=r[e][0];return n.color||t(n.base)}(t)}),function t(e,n,i){Object(o.d)(function(t){let e=Object(o.c)(r,(e,n)=>n[0].base===t),n=Object(o.e)(e,(t,e)=>({[t]:e.flatMap(t=>t.flat).sort((t,e)=>t.ply<e.ply?-1:t.ply===e.ply?0:1)}));return Object(o.e)(n,(e,n)=>{if(0===n.length)return{};let r=h(t,n[0].ply-1);return{[e]:d(n,r)}})}(e),(e,r)=>{l[e]=r,u[e]=n,t(e,n+1)})}("initial",0),this.lineDepthFor=t=>u[t],this.colorFor=t=>c[t],this.situationFor=h,this.moveFor=f}n.d(e,"Ply",function(){return kt}),n.d(e,"MoveLine",function(){return xt}),n.d(e,"History",function(){return Ot}),n.d(e,"makePlys",function(){return jt}),n.d(e,"makeMoveLines",function(){return Et}),n.d(e,"Play",function(){return Ct}),n.d(e,"app",function(){return St});const jt=(t,e)=>{let{element:n}=e,r=[];for(let i of n.querySelectorAll("[data-ply]")){let n=new kt(t,e,i);n.init({game:i.dataset.game,color:i.dataset.color,shapes:i.dataset.shapes,ply:i.dataset.ply}),r.push(n)}return r},Et=(t,e)=>{let{element:n}=e,r=[];for(let i of n.querySelectorAll("[data-line]"))r.push(new xt(t,e,i));return r};function Ct(t){let{element:e}=t,n=this.lines=Et(this,t),r=(this.history=new Ot(this,t),this.plys=jt(this,t)),i=Object(J.div)(".hover-ply",[],J.fHide),o=new kt(this,t,i);this.wrap=()=>{e.appendChild(i),n.forEach(t=>t.wrap()),r.forEach(t=>t.wrap())};let l=this.visiblePly=()=>r.filter(t=>t.isInViewport)[0];function s(){r.forEach(t=>t.syncVisible())}this.listen=()=>{!function(t){let e;document.addEventListener("scroll",function(n){clearTimeout(e),e=setTimeout(t,60)},!1)}(s),s()},this.hide=()=>{Object(J.fHide)(i)},this.show=(e,n,r)=>{let s=l(),a=[window.pageXOffset,window.pageYOffset];if(s)a[0]+=s.bounds().left,a[1]+=s.bounds().top;else{let{clientWidth:e}=t.element,n=r.getBoundingClientRect(),o=i.getBoundingClientRect();n.left<e/2&&(a[0]+=e-o.width-4)}Object(J.fTranslateAbs)(a)(i),o.init({game:e,ply:n}),o.render(),Object(J.fShow)(i)}}function St(t,e){let n={element:t};if(e.content){let n=Object(wt.parseMdFull)(e.content);Object(wt.updatePreview)(n,t)}let r=new Ct(n);r.wrap(),r.listen()}}])},function(t,e,n){t.exports=n(2)},function(t,e,n){n(3);const r=n(4);t.exports=r.app,t.exports.version="1.3.1"},function(t,e,n){},function(t,e,n){"use strict";n.r(e);var r=function(t,e){let n,r=0;return function(...i){let o=Date.now()-r;function l(){n=void 0,r=Date.now(),e(...i)}n&&clearTimeout(n),o>t?l():n=setTimeout(l,t-o)}};function i(t,e=[],n){let[r,...i]=t.split("."),o=document.createElement(r);return i.forEach(t=>{o.classList.add(t)}),e.forEach?e.forEach(t=>{o.appendChild(t)}):o.append(e),n&&n(o),o}const o=(t,e)=>n=>{n.addEventListener(t,t=>{e(n,t)})};var l=n(0),s=n.n(l);n.d(e,"app",function(){return c});let{parseMdFull:a,updatePreview:u}=l.md;function c(t,e={}){let n,{input:l,content:c=""}=e;l||(l=()=>{});let{$wrapper:f,$editor:h,$preview:d}=function({input:t,caret:e}){var n;let r=i("ch-editor",[i("textarea",[],(n=[o("input",(n,r)=>{e(r.target.selectionStart),t(n.value)})],(...t)=>{n.forEach(e=>e(...t))}))]),l=i("ch-preview");return{$wrapper:i("ch-wrap",[r,l]),$editor:r,$preview:l}}({content:c,caret:t=>{let e;for(let r in n){let i=n[r];if(!(i.pos<t))break;e=i}e&&function(t,e){let n=t.getBoundingClientRect();t.scrollTop=e.offsetTop-.3*n.width}(d,e.$_)},input:r(2e3,t=>{l(t),n=u(a(t),d),s()(d,{})})});h.firstChild.value=c,n=u(a(h.firstChild.value),d),s()(d,{}),t.appendChild(f)}}]);