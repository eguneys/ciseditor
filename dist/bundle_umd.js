!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){window,e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){"use strict";function r(e,t=[],n){let[r,...o]=e.split("."),i=document.createElement(r);return o.forEach(e=>{i.classList.add(e)}),t.forEach?t.forEach(e=>{i.appendChild(e)}):i.append(t),n&&n(i),i}n.r(t),n.d(t,"tag",function(){return r}),n.d(t,"div",function(){return o}),n.d(t,"textNode",function(){return i}),n.d(t,"updateChildren",function(){return l}),n.d(t,"fTranslateAbs",function(){return s}),n.d(t,"fAddClass",function(){return a}),n.d(t,"fAttribute",function(){return u}),n.d(t,"fListen",function(){return c}),n.d(t,"fHide",function(){return f}),n.d(t,"fShow",function(){return d});const o=(e,t,n)=>r("div"+e,t,n),i=e=>document.createTextNode(e),l=(e,t)=>{for(e=e.firstChild;e;)t(e),e=e.nextSibling},s=e=>t=>{t.style.transform=`translate(${e[0]}px,${e[1]}px)`},a=e=>t=>{e.split(".").forEach(e=>{t.classList.add(e)})},u=e=>t=>{Object.keys(e).forEach(n=>{t.setAttribute(n,e[n])})},c=(e,t)=>n=>{n.addEventListener(e,()=>{t(n)})},f=e=>{e.classList.contains("hidden")||e.classList.add("hidden")},d=e=>{e.classList.contains("hidden")&&e.classList.remove("hidden")}},function(e,t,n){"use strict";function r(e){let t={};for(let n in e)t[n]=e[n];return t}function o(e,t){let n=[],r=[];return e.forEach(e=>t(e)?n.push(e):r.push(e)),[n,r]}function i(e,t){let n={};return Object.keys(e).forEach(r=>{let o=t(r,e[r]),i=Object.keys(o)[0];n[i]=o[i]}),n}function l(e,t){Object.keys(e).forEach(n=>t(n,e[n]))}function s(e,t){let n={};for(let r in e)t(r,e[r])&&(n[r]=e[r]);return n}function a(e,t){let n={};return e.forEach(e=>{let r=t(e),o=Object.keys(r)[0];n[o]||(n[o]=[]),n[o].push(r[o])}),n}n.d(t,"b",function(){return r}),n.d(t,"f",function(){return o}),n.d(t,"e",function(){return i}),n.d(t,"d",function(){return l}),n.d(t,"c",function(){return s}),n.d(t,"a",function(){return a})},function(e,t,n){"use strict";n.r(t);const r=1,o=2,i=3,l=1,s=2;function a(e){return function(e){const t=/^#([^\n]*)/,n=/^=([^\n]*)/;let l=[],s=[],a=e.split("\n"),u=0;if(a.forEach(e=>{if(""===e){if(l.length){let e=l.join("\n");s.push({type:r,pos:u,content:e}),l=[],u+=e.length+1}return void(u+=1)}let a;if(a=e.match(n)){let e=l.join("\n");l.length&&(s.push({type:r,pos:u,content:e}),l=[],u+=e.length+1),e=a[1],s.push({type:i,pos:u,content:e}),u+=e.length+2}else if(a=e.match(t)){let e=l.join("\n");l.length&&(s.push({type:r,pos:u,content:e}),l=[],u+=e.length+1),e=a[1],s.push({type:o,pos:u,content:e}),u+=e.length+2}else l.push(e)}),l.length){let e=l.join("\n");s.push({type:r,pos:u,content:e}),l=[],u+=e.length}return s}(e).map(e=>(e.type===r&&(e.content=function(e){return function(e){const t=/^</,n=/>$/;let r=s,o=[],i=[];return e.split(" ").forEach(e=>{let a;r===s?(a=e.match(t))?(i.push({type:s,content:o.join(" ")+" "}),r=l,o=[e],(a=e.match(n))&&(i.push({type:l,content:o.join(" ")}),r=s,o=[])):o.push(e):r===l&&((a=e.match(n))?(o.push(e),i.push({type:l,content:o.join(" ")}),r=s,o=[]):o.push(e))}),o.length>0&&i.push({type:r,content:o.join(" ")}),i}(e).map(e=>(e.type===l&&(e.content=function(e){let t;if(t=(e=e.substring(1,e.length-1)).match(/^([a-zA-Z][^\s]*) ([a-zA-Z][^\s]*) (.*)/)){let[e,n,r,o]=t;return{variation:n,base:r,line:o}}return{line:e}}(e.content)),e))}(e.content)),e))}n(1);var u=n(0);function c(e,t){let n=[],r=t.firstChild;for(;r;)n.push(r),r=r.nextSibling;for(let e of n)t.removeChild(e);let o=e.map(({type:e,content:t,pos:n})=>({pos:n,$_:f(e,t)}));return o.forEach(e=>{t.appendChild(e.$_)}),o}function f(e,t){switch(e){case i:return function(e){return Object(u.tag)("div",[],Object(u.fAttribute)({"data-ply":e}))}(t);case r:return function(e){return Object(u.tag)("p",e.map(({type:e,content:t})=>{switch(e){case l:let n=t.variation?`${t.variation} ${t.base}`:null,r={"data-line":t.line};return n&&(r["data-game"]=n),Object(u.tag)("span",[],Object(u.fAttribute)(r));case s:return Object(u.textNode)(t);default:return null}}))}(t);case o:return Object(u.tag)("h2",t);default:return null}}n.d(t,"parseMdFull",function(){return a}),n.d(t,"updatePreview",function(){return c})},function(e,t,n){e.exports=n(4)},function(e,t,n){n(5),n(6),n(7),n(8);const r=n(9);e.exports=r.app,e.exports.md=n(2)},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"files",function(){return k}),n.d(r,"ranks",function(){return x}),n.d(r,"allKeys",function(){return O}),n.d(r,"pos2key",function(){return j}),n.d(r,"key2pos",function(){return C}),n.d(r,"black",function(){return E}),n.d(r,"white",function(){return S}),n.d(r,"asWhite",function(){return P}),n.d(r,"flip",function(){return A}),n.d(r,"readShapes",function(){return R}),n.d(r,"readFen",function(){return F}),n.d(r,"readMoves",function(){return B}),n.d(r,"readPly",function(){return K}),n.d(r,"writeFen",function(){return L}),n.d(r,"fPosToTranslateAbs",function(){return T});var o={};n.r(o),n.d(o,"svg",function(){return X}),n.d(o,"renderShape",function(){return Y}),n.d(o,"renderMarker",function(){return te});var i=n(1);function l(e){this.index=e,this.char=String.fromCharCode(97+e)}function s(e){this.index=e,this.char=String.fromCharCode(49+e)}const a={A:new l(0),B:new l(1),C:new l(2),D:new l(3),E:new l(4),F:new l(5),G:new l(6),H:new l(7),of:e=>new l(7&e.index)},u={of:e=>new s(e.index>>3)};function c(e){this.index=e;let t=a.of(this),n=u.of(this);this.file=t,this.rank=n,this.key=t.char+n.char,this.hore=(e,t)=>{let n=t(this);return n?[n,...e(n)?[]:n.hore(e,t)]:[]},this.righte=e=>this.hore(e,e=>e.right()),this.lefte=e=>this.hore(e,e=>e.left()),this.down=()=>f.at(t.index,n.index-1),this.left=()=>f.at(t.index-1,n.index),this.downLeft=()=>f.at(t.index-1,n.index-1),this.downRight=()=>f.at(t.index+1,n.index-1),this.up=()=>f.at(t.index,n.index+1),this.right=()=>f.at(t.index+1,n.index),this.upLeft=()=>f.at(t.index-1,n.index+1),this.upRight=()=>f.at(t.index+1,n.index+1)}const f={apply:e=>new c(e),atfr:(e,t)=>new c(e.index+8*t.index),at:(e,t)=>0<=e&&e<8&&0<=t&&t<8?new c(e+8*t):null},d=[];for(let e=0;e<64;e++)d.push(e);f.all=d.map(e=>new c(e)),f.allKeys={},f.all.forEach(e=>f.allKeys[e.key]=e),f.fromKey=e=>f.allKeys[e],f.A1=new c(0),f.B1=new c(1),f.C1=new c(2);const p={forsyth:"P",roleString:"pawn"},h={forsyth:"N",roleString:"knight",dirs:[e=>f.at(e.file.index-1,e.rank.index+2),e=>f.at(e.file.index-1,e.rank.index-2),e=>f.at(e.file.index+1,e.rank.index+2),e=>f.at(e.file.index+1,e.rank.index-2),e=>f.at(e.file.index-2,e.rank.index+1),e=>f.at(e.file.index-2,e.rank.index-1),e=>f.at(e.file.index+2,e.rank.index+1),e=>f.at(e.file.index+2,e.rank.index-1)]},y={forsyth:"B",roleString:"bishop",dirs:[e=>e.upLeft(),e=>e.upRight(),e=>e.downLeft(),e=>e.downRight()]},m={color:e=>({role:"rook",color:e}),forsyth:"R",roleString:"rook",dirs:[e=>e.up(),e=>e.down(),e=>e.left(),e=>e.right()]},g={forsyth:"Q",roleString:"queen",dirs:[m.dirs,y.dirs].flat()},b={color:e=>({role:"king",color:e}),forsyth:"K",roleString:"king",dirs:g.dirs},w={all:[b,g,y,m,p,h],allByRole:{}};w.all.forEach(e=>w.allByRole[e.roleString]=e),w.allByForsyth={},w.all.forEach(e=>w.allByForsyth[e.forsyth]=e),w.forsyth=e=>w.allByForsyth[e];const v={key:"g",color:"#15781B",opacity:1,lineWidth:10},k=["a","b","c","d","e","f","g","h"],x=["1","2","3","4","5","6","7","8"],O=Array.prototype.concat(...k.map(e=>x.map(t=>e+t))),j=e=>O[8*e[0]+e[1]],C=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],E="black",S="white";function P(e){return e===S}function A(e){return e===S?E:S}let M={w:S,b:E},$={k:"king",q:"queen",r:"rook",b:"bishop",n:"knight",p:"pawn"};function R(e){return e?e.split(" ").map(e=>{let[t,n]=e.split("-");return{orig:(e=>e)(t),dest:(e=>e)(n),brush:v}}):[]}function F(e){let[t,n,r,o]=e.split(" "),i=M[n],l={};return t.split("/").forEach((e,t)=>{t=7-t;let n=0;for(let r of e){let e,o;(e=$[r])?o=E:(e=$[r.toLowerCase()])&&(o=S),o?(l[j([n,t])]={role:e,color:o},n++):n+=parseInt(r)}}),{pieces:l,color:i}}function B(e){const t=/^(\d*)\.\.\.$/,n=/^(\d*)\.$/;let r,o,i=[];return e.split(" ").forEach(e=>{let l;(l=e.match(t))?(o=2*parseInt(l[0]),r=[null]):(l=e.match(n))?(o=2*parseInt(l[0])-1,r=[]):(l=moveMatch(e))&&(r.push({ply:o,...l}),o++,2===r.length&&(i.push(r),r=[]))}),1===r.length&&i.push(r),{moves:i}}function K(e){return parseInt(e)}function L({pieces:e}){let t="";for(let n=7;n>=0;n--){let r=0;for(let o=0;o<=7;o++){let i;if(i=e[j([o,n])]){r>0&&(t+=r,r=0);let e=w.allByRole[i.role];t+=i.color===S?e.forsyth.toUpperCase():e.forsyth.toLowerCase()}else r++}r>0&&(t+=r),t+="/"}return t}const T=e=>{const t=e.width/8,n=e.height/8;return(e,r)=>((e,t,n,r)=>[(t?e[0]:7-e[0])*n,(t?7-e[1]:e[1])*r])(e,r,t,n)};function _(e){return{value:e}}function N(e){return{invalid:e}}function q(e,t){return e?_(e):N(t)}const I={name:"king",castledKingFile:a.G,castledRookFile:a.F,tripToRook:(e,t)=>e.righte(e=>t.pieces[e.key])},H={name:"queen",castledKingFile:a.C,castledRookFile:a.D,tripToRook:(e,t)=>e.lefte(e=>t.pieces[e.key])};function V(e,t){this.take=n=>{let r=Object(i.b)(e);return delete r[n.key],new V(r,t)},this.place=(n,r)=>{let o=Object(i.b)(e);return o[r.key]=n,new V(o,t)},this.move=(n,r)=>{let o=Object(i.b)(e);return o[r.key]=o[n.key],delete o[n.key],new V(o,t)},this.taking=(n,r)=>{let o=Object(i.b)(e);return o[r.key]=o[n.key],delete o[n.key],new V(o,t)},this.actorsOf=()=>{let[e,t]=Object(i.f)(Object.values(this.actors),e=>"white"===e.color);return{white:e,black:t}},this.kingPosOf=t=>{let n=Object.keys(e).find(n=>{let r=e[n];return r.color===t&&"king"===r.role});return f.fromKey(n)},this.actorAt=e=>this.actors[e],this.color=t,this.pieces=e,this.actors=Object(i.e)(e,(e,t)=>({[e]:new D(t,f.fromKey(e),this)}))}function W(e,t){this.board=e,this.color=t,e.actorsOf(t)}function Q({piece:e,orig:t,dest:n,situationBefore:r,after:o,capture:i,promotion:l,castle:s,enpassant:a}){this.piece=e,this.orig=t,this.dest=n,this.situationBefore=()=>r,this.after=()=>o,this.before=()=>r.board,this.situationAfter=()=>new W(o,A(e.color))}function D(e,t,n){let r=e.color;this.color=r,this.pos=t,this.pseudoValidMoves=function(){let i=[];switch(e.role){case"pawn":let d=s()(t),p=d;function f(e){let o=e(d);if(!o)return null;if(!n.pieces[o.key]||n.pieces[o.key].color===r)return null;let i=n.taking(t,o);return c(o,i,{capture:o})}let w=s()(p),v=[];if(w){let e=n.move(t,w);v=c(w,e)}i.push([p&&l(p)||[],v,f(e=>e.left())||[],f(e=>e.right())||[]].flat());break;case"king":i.push(a(b.dirs)),i.push(o());break;case"knight":i.push(a(h.dirs));break;case"bishop":i.push(u(y.dirs));break;case"rook":i.push(u(m.dirs));break;case"queen":i.push(u(g.dirs))}return i.flatMap(e=>e)};const o=()=>i(I).concat(i(H));function i(e){let t=n.kingPosOf(r);if(!t)return[];let o=e.tripToRook(t,n),i=o[o.length-1],l=f.atfr(e.castledKingFile,t.rank),s=f.atfr(e.castledRookFile,i.rank),a={king:{[t.key]:l},rook:{[i.key]:s},side:e.name};return[c(t,n.take(t).take(i).place(b.color(r),l).place(m.color(r),s),{castle:a})]}function l(e){let r=n.move(t,e);return r?c(e,r):null}function s(){return function(e){return"white"===e?e=>e.up():e=>e.down()}(e.color)}function a(e){return e.flatMap(e=>e(t)||[]).flatMap(e=>{let r=n.move(t,e);return r?[c(e,r)]:[]})}function u(e){let o=[];return e.forEach(e=>(function e(i,l){let s;if(s=l(i)){let i=n.pieces[s.key];if(i){if(i.color!==r){let e=n.taking(t,s);o.push(c(s,e,{capture:s}))}}else{let r=n.move(t,s);r&&o.push(c(s,r)),e(s,l)}}})(t,e)),o}function c(r,o,i){let l,s,a,u;return i&&(l=i.capture,a=i.castle,s=i.promotion,u=i.enpassant),new Q({piece:e,orig:t,dest:r,situationBefore:new W(n,e.color),after:o,capture:l,castle:a,promotion:s,enpassant:u})}this.castleOn=i}function z(e,t,n,r,o,l,s){function a(e,t){return!e||e===t}this.san=s,this.dest=e,this.role=t,this.capture=n,this.file=r,this.rank=o,this.promotion=l,this.move=n=>{let l=null;return Object(i.d)(n.board.pieces,(i,s)=>{if(!l&&s.color===n.color&&s.role===t.roleString&&a(r,f.fromKey(i).file.char)&&a(o,f.fromKey(i).rank.char)){let t=new D(s,f.fromKey(i),n.board);l=t.pseudoValidMoves().find(t=>t.dest.key===e.key)}}),l?_(l):N(`No move found: ${s}`)}}function Z(e,t){this.san=t,this.side=e,this.move=t=>{let n=q(t.board.kingPosOf(t.color),"No king found");if(n.invalid)return n;let r=q(t.board.actorAt(n.value.key),"No Actor found");return r.invalid?r:q(r.value.castleOn(e)[0],"Cannot castle")}}V.initial=()=>V.fromFen("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"),V.fromFen=e=>{let{pieces:t,color:n}=F(e);return new V(t,n)},W.apply=()=>new W(V.initial(),"white");var G=n(0);function X(e,t=[]){let n=document.createElementNS("http://www.w3.org/2000/svg",e);return t.forEach&&t.forEach(e=>n.appendChild(e)),n}function Y(e,t,n){let r,o=ee(C(e.orig),t);if(e.dest){let i=ee(C(e.dest),t);r=function(e,t,n,r){const o=function(e){return 10/512*e.width}(r),i=J(t,r),l=J(n,r),s=l[0]-i[0],a=l[1]-i[1],u=Math.atan2(a,s),c=Math.cos(u)*o,f=Math.sin(u)*o;return ne(X("line"),{stroke:e.color,"stroke-width":U(e,r),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+e.key+")",opacity:e.opacity,x1:i[0],y1:i[1],x2:l[0]-c,y2:l[1]-f})}(e.brush,o,i,n)}else r=function(e,t,n){const r=J(t,n),o=function(e){return e.width/512*4}(n),i=(n.width+n.height)/32;return ne(X("circle"),{stroke:e.color,"stroke-width":o,fill:"none",opacity:e.opacity,cx:r[0],cy:r[1],r:i-o/2})}(e.brush,o,n);return r}function U(e,t){return(e.lineWidth||10)/512*t.width}function J(e,t){return[(e[0]+.5)*t.width/8,(7.5-e[1])*t.height/8]}function ee(e,t){return"white"===t?e:[7-e[0],7-e[1]]}function te(e){const t=ne(X("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return t.appendChild(ne(X("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("mdKey",e.key),t}function ne(e,t){for(const n in t)e.setAttribute(n,t[n]);return e}let{ranks:re,files:oe,key2pos:ie,fPosToTranslateAbs:le}=r,{svg:se,renderMarker:ae,renderShape:ue}=o,{div:ce,tag:fe,fTranslateAbs:de,fListen:pe,updateChildren:he}=G;var ye=n(2);function me(e,t,n){let r,o,i,l,s,a,u,c,f,d,{history:p}=e;this.el=n,this.bounds=()=>c,this.init=e=>{if(r=e.game||"main",o=e.color,i=R(e.shapes),l=parseInt(e.ply),s={},a=[],u=p.moveFor(r,l)){let e=u.value.situationAfter();s=e.board.pieces,a.push(u.value.orig.key),a.push(u.value.dest.key)}o=o||p.colorFor(r),c=n.getBoundingClientRect()},this.syncVisible=()=>{c=n.getBoundingClientRect(),this.isInViewport=function(e){return e.top>=0&&e.left>=0&&e.bottom<=window.innerHeight&&e.right<=window.innerWidth}(c)},this.render=()=>{d&&(d(),n.removeChild(f.wrapper)),this.wrap()},this.wrap=()=>{f=function(e,t,n,r,o){let i=P(e),l=le(r),s=fe("md-board",[...o.map(e=>{let t=ie(e),n=fe("square.last-move",[],de(l(t,i)));return n.mdKey=e,n}),...Object.keys(t).map(e=>{let n=ie(e),r=t[e],o=fe(`piece.${r.color}.${r.role}`,[],de(l(n,i)));return o.mdKey=e,o})]),a=se("svg",[se("defs",[ae(v)]),...n.map(t=>ue(t,e,r))]);return{wrapper:fe("md-wrap",[s,a,fe("coords.ranks."+e,re.map(e=>fe("coord",e))),fe("coords.files."+e,oe.map(e=>fe("coord",e)))]),board:s,svg:a}}(o,s,i,c,a),n.appendChild(f.wrapper),d=function(e,t){const n=new window.ResizeObserver(()=>{!function(e,t){let n=t.getBoundingClientRect(),r=le(n);he(t,t=>{de(r(ie(t.mdKey),e))(t)})}(P(o),f.board),function(e,t,n){let{board:r,svg:o}=e,i=r.getBoundingClientRect(),l=o.firstChild,s=[];for(l=l.nextSibling;l;)s.push(l),l=l.nextSibling;for(const e of s)o.removeChild(e);t.forEach(e=>{o.appendChild(ue(e,n,i))})}(f,i,o)});return n.observe(e),()=>{n.unobserve(e)}}(n)}}function ge(e,t,n){let r=n.dataset.game||"main initial",o=n.dataset.line,i=n.dataset.color,l=r.split(" ");1===l.length&&l.push("main"),this.game=l[0],this.base=l[1],this.color=i;let s=function(e){const t=/^(\d*)\.\.\.$/,n=/^(\d*)\.$/;let r,o,i=[];return e.split(" ").forEach(e=>{let l;if(l=e.match(t))o=2*parseInt(l[0]),r=[null];else if(l=e.match(n))o=2*parseInt(l[0])-1,r=[];else{let{value:t,invalid:n}=function(e){if("O-O"===e||"o-o"===e||"0-0"===e)return _(new Z(I,e));if("O-O-O"===e||"o-o-o"===e||"0-0-0"===e)return _(new Z(H,e));let t=e.match(/^(N|B|R|Q|K|)([a-h]?)([1-8]?)(x?)([a-h][1-8])(=?[NBQR]?)(\+?)(\#?)$/);if(!t)return n(`Couldn't parse ${e}`);let[r,o,i,l,s,a,u,c,d]=t,h=f.fromKey(a);return a?_(new z(h,w.forsyth(o)||p,""!==s,i,l,u,e)):n(`Invalid move ${e}`)}(e);n?(console.warn(n),r.push(null)):(r.push({ply:o,move:t}),o++),2===r.length&&(i.push(r),r=[])}}),1===r.length&&i.push(r),i}(o);this.flat=s.flat().flatMap(e=>e?[e]:[]);let a=(t,n)=>{e.show(this.game,t,n)},u=()=>{e.hide()};this.wrap=()=>{let t=e.history.lineDepthFor(this.game),r=Object(G.fAddClass)(`depth${t}`);(function(e,t,n){let r=e=>r=>{["touchstart","mouseover"].forEach(n=>pe(n,n=>t(e,n))(r)),["touchend","mouseout"].forEach(e=>pe(e,n)(r))};return e.flatMap(([e,t])=>{let n=e&&r(e.ply),o=t&&r(t.ply);return e&&t?[fe("strong.moven",(e.ply+1)/2+". "),fe("span.movem",e.move.san+" ",n),fe("span.movem",t.move.san+" ",o)]:e?[fe("strong.moven",(e.ply+1)/2+". "),fe("span.movem",e.move.san+" ",n)]:[fe("strong.moven",t.ply/2+"... "),fe("span.movem",t.move.san+" ",o)]})})(s,a,u).forEach(e=>n.appendChild(e)),r(n)}}function be(e,t){let{lines:n}=e,r=Object(i.a)(n,e=>({[e.game]:e})),o=Object.keys(r),l={},s={},a={};function u(e,t){let n=l[e].find(e=>e.ply===t);return n||(console.warn(`No move found for ${e} ${t}`),null)}function c(e,t){return 0===t?W.apply():u(e,t).value.situationAfter()}function f(e,t){return e.map(({ply:e,move:n})=>{if(!t)return{ply:e,value:null};let{invalid:r,value:o}=n.move(t);return r?(console.warn(r),t=null,{ply:e,value:r}):(t=o.situationAfter(),{ply:e,value:o})}).filter(e=>e)}o.forEach(e=>{a[e]=function e(t){if("initial"===t||!r[t])return"white";let n=r[t][0];return n.color||e(n.base)}(e)}),function e(t,n,o){Object(i.d)(function(e){let t=Object(i.c)(r,(t,n)=>n[0].base===e),n=Object(i.e)(t,(e,t)=>({[e]:t.flatMap(e=>e.flat).sort((e,t)=>e.ply<t.ply?-1:e.ply===t.ply?0:1)}));return Object(i.e)(n,(t,n)=>{let r=c(e,n[0].ply-1);return{[t]:f(n,r)}})}(t),(t,r)=>{l[t]=r,s[t]=n,e(t,n+1)})}("initial",0),this.lineDepthFor=e=>s[e],this.colorFor=e=>a[e],this.situationFor=c,this.moveFor=u}n.d(t,"Ply",function(){return me}),n.d(t,"MoveLine",function(){return ge}),n.d(t,"History",function(){return be}),n.d(t,"makePlys",function(){return we}),n.d(t,"makeMoveLines",function(){return ve}),n.d(t,"Play",function(){return ke}),n.d(t,"app",function(){return xe});const we=(e,t)=>{let{element:n}=t,r=[];for(let o of n.querySelectorAll("[data-ply]")){let n=new me(e,t,o);n.init({game:o.dataset.game,color:o.dataset.color,shapes:o.dataset.shapes,ply:o.dataset.ply}),r.push(n)}return r},ve=(e,t)=>{let{element:n}=t,r=[];for(let o of n.querySelectorAll("[data-line]"))r.push(new ge(e,t,o));return r};function ke(e){let{element:t}=e,n=this.lines=ve(this,e),r=(this.history=new be(this,e),this.plys=we(this,e)),o=Object(G.div)(".hover-ply",[],G.fHide),i=new me(this,e,o);this.wrap=()=>{t.appendChild(o),n.forEach(e=>e.wrap()),r.forEach(e=>e.wrap())};let l=this.visiblePly=()=>r.filter(e=>e.isInViewport)[0];function s(){r.forEach(e=>e.syncVisible())}this.listen=()=>{!function(e){let t;document.addEventListener("scroll",function(n){clearTimeout(t),t=setTimeout(e,60)},!1)}(s),s()},this.hide=()=>{Object(G.fHide)(o)},this.show=(t,n,r)=>{let s=l(),a=[window.pageXOffset,window.pageYOffset];if(s)a[0]+=s.bounds().left,a[1]+=s.bounds().top;else{let{clientWidth:t}=e.element,n=r.getBoundingClientRect(),i=o.getBoundingClientRect();n.left<t/2&&(a[0]+=t-i.width-4)}Object(G.fTranslateAbs)(a)(o),i.init({game:t,ply:n}),i.render(),Object(G.fShow)(o)}}function xe(e,t){let n={element:e};if(t.content){let n=Object(ye.parseMdFull)(t.content);Object(ye.updatePreview)(n,e)}let r=new ke(n);r.wrap(),r.listen()}}])},function(e,t,n){e.exports=n(2)},function(e,t,n){n(3);const r=n(4);e.exports=r.app,console.log("[CisEditor]")},function(e,t,n){},function(e,t,n){"use strict";function r(e,t=[],n){let[r,...o]=e.split("."),i=document.createElement(r);return o.forEach(e=>{i.classList.add(e)}),t.forEach?t.forEach(e=>{i.appendChild(e)}):i.append(t),n&&n(i),i}n.r(t);const o=(e,t)=>n=>{n.addEventListener(e,e=>{t(n,e)})};var i=n(0),l=n.n(i);n.d(t,"app",function(){return u});let{parseMdFull:s,updatePreview:a}=i.md;function u(e,t={}){let n,{input:i,content:u=""}=t;i||(i=()=>{});let{$wrapper:c,$editor:f,$preview:d}=function({input:e,caret:t}){var n;let i=r("ch-editor",[r("textarea",[],(n=[o("input",(n,r)=>{t(r.target.selectionStart),e(n.value)})],(...e)=>{n.forEach(t=>t(...e))}))]),l=r("ch-preview");return{$wrapper:r("ch-wrap",[i,l]),$editor:i,$preview:l}}({content:u,caret:e=>{let t;for(let r in n){let o=n[r];if(!(o.pos<e))break;t=o}t&&function(e,t){let n=e.getBoundingClientRect();e.scrollTop=t.offsetTop-.3*n.width}(d,t.$_)},input:e=>{i(e),n=a(s(e),d);try{l()(d,{})}catch(e){}}});f.firstChild.value=u,n=a(s(f.firstChild.value),d);try{l()(d,{})}catch(e){}e.appendChild(c)}}])});